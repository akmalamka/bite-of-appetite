substitutions:
  _ARTIFACT_NAME: 'asia-east1-docker.pkg.dev/bite-of-appetite/cloud-build-ci-cd'
  _IMAGE_NAME: 'biteofappetite'

options:
  dynamicSubstitutions: true
  logging: CLOUD_LOGGING_ONLY

steps:
  - id: 'Installing dependencies'
    name: '${_ARTIFACT_NAME}/${_IMAGE_NAME}'
    entrypoint: 'pnpm'
    args:
      - 'install'
      - '--frozen-lockfile'
  - id: 'Building the site'
    name: '${_ARTIFACT_NAME}/${_IMAGE_NAME}'
    entrypoint: 'pnpm'
    args:
      - 'run'
      - 'build'
  - id: 'Deploying'
    name: '${_ARTIFACT_NAME}/${_IMAGE_NAME}'
    entrypoint: 'pnpm'
    args: ['deploy:staging']

images:
- '${_ARTIFACT_NAME}/${_IMAGE_NAME}'
